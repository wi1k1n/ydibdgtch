<!DOCTYPE html>
<html>
<head>
      <title>Chess Coding Thingy</title>
      <link rel="stylesheet"
href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css"
integrity="sha384-q94+BZtLrkL1/ohfjR8c6L+A6qzNH9R2hBLwyoAfu3i/WCvQjzL2RQJ3uNHDISdU"
crossorigin="anonymous">
      <link rel="stylesheet" href="style.css">
      <style>
        .float-container {
          border: 1px solid black;
          margin: 1rem;
          padding: 2rem 2rem;
          text-align: center;
        }
        .float-child {
          display: inline-block;
          border: 1px solid red;
          padding: 1rem 1rem;
          vertical-align: middle;
        } 
      </style>
</head>
<body>
    <div class="form-style-5">
      <button id="btnConnect">Connect</button>
      <button id="btnDisconnect">Disconnect</button>

      <input type="text" id="txbxMsg" name="txbxMsg", style="width: 500px">
      <button id="btnSend">Send</button>
    </div>
    <div class="form-style-5">
      <button id="btnSendInitialization">Send initialization</button>
      <button id="btnRequestCurrentFen">Request FEN</button>
    </div>
    <div class="float-container form-style-5">
      <div class="float-child">
        <div id="controlPanel"></div>
      </div>
      <div class="float-child">
        <div id="myBoard"></div>
      </div>
    </div>
    <div class="form-style-5">
      <select name="slFens" id="slFens">
        <option value="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1">Start</option>
        <option value="8/8/8/8/8/8/8/8 w - - 0 1">Clean</option>
        <option value="k1K5/8/8/8/2b5/3n4/1N6/8 w - - 1 1">Ambiguity</option>
        <option value="r1bqkbnr/pppp1ppp/2n5/1B2p3/4P3/5N2/PPPP1PPP/RNBQK2R">Ruy Lopez</option>
      </select>
      <input type="text" id="txbxFen" name="txbxFen", style="width: 500px">
      <button id="btnSetFen">Set FEN</button>
      <button id="btnSetBoard">Set Board</button>
      <button id="btnGetFen">Get FEN â†µ</button>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2"
      crossorigin="anonymous"></script>
    <script src="chessboard-1.0.0.min.js"></script>
    <script src="chess-0.10.2.min.js"></script>

    <script type="text/javascript">
      const BOARDSIZE = 630;
      const INITIAL_FEN = 'k1K5/8/8/8/2b5/3n4/1N6/8 w - - 1 1';
      // const INITIAL_FEN = 'r1bqkbnr/pppp1ppp/2n5/1B2p3/4P3/5N2/PPPP1PPP/RNBQK2R';

      // https://chessboardjs.com/
      // NOTE: this example uses the chess.js library:
      // https://github.com/jhlywa/chess.js


      document.getElementById('myBoard').setAttribute('style', 'width:'+BOARDSIZE+'px');

      var board = null
      var game = new Chess(INITIAL_FEN)

      function onDragStart (source, piece, position, orientation) {
        // do not pick up pieces if the game is over
        if (game.game_over()) return false

        // only pick up pieces for White
        if (piece.search(/^b/) !== -1) return false
      }

      function makeRandomMove () {
        var possibleMoves = game.moves();

        // game over
        if (possibleMoves.length === 0) return;

        var randomIdx = Math.floor(Math.random() * possibleMoves.length);
        game.move(possibleMoves[randomIdx]);
        board.position(game.fen());
        console.log(possibleMoves[randomIdx]);
      }

      function onDrop (source, target) {
        // see if the move is legal
        var move = game.move({
          from: source,
          to: target,
          promotion: 'q' // NOTE: always promote to a queen for example simplicity
        })

        // illegal move
        if (move === null) return 'snapback'

        // make random legal move for black
        window.setTimeout(makeRandomMove, 250)
      }

      // update the board position after the piece snap
      // for castling, en passant, pawn promotion
      function onSnapEnd () {
        board.position(game.fen())
      }

      var config = {
        draggable: false,
        // position: 'start',
        // position: {},
        position: INITIAL_FEN,
        onDragStart: onDragStart,
        onDrop: onDrop,
        onSnapEnd: onSnapEnd
      }
      board = Chessboard('myBoard', config)
    </script>

    <script src="https://unpkg.com/konva@9.2.0/konva.min.js"></script>
    <script src="controlPanel.js"></script>
</body>
</html>